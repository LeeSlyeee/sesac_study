<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비플페이 데이터베이스 설계도 (ERD)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        // Mermaid 초기화 설정
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default', // 'dark', 'forest', 'neutral' 등으로 변경 가능
            er: { useMaxWidth: true }
        });
    </script>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f8f9fa;
        }

        h1 {
            color: #333;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 1000px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body>

    <h1>비플페이 데이터베이스 설계도 (ERD)</h1>

    <div class="container">
        <pre class="mermaid">
erDiagram
    USERS ||--o{ ACCOUNTS : "등록 및 인증"
    USERS ||--o{ GIFT_VOUCHER : "구매 및 보유"
    USERS ||--o{ TRANSACTIONS : "결제 수행"
    MERCHANTS ||--o{ TRANSACTIONS : "결제 수취"

    USERS {
        int user_id PK "사용자 고유 번호"
        string user_name "실명"
        string phone_number "휴대폰 번호(Unique)"
        string email "이메일"
        string ci_di_info "본인인증 식별값"
        enum status "계정 상태(ACTIVE, SLEEP, WITHDRAWN)"
        timestamp created_at "가입 일시"
    }

    ACCOUNTS {
        int account_id PK "계좌 고유 번호"
        int user_id FK "사용자 ID"
        string bank_code "은행 코드"
        string account_number_enc "암호화 계좌번호"
        boolean is_main_account "주 결제 계좌 여부"
        timestamp verified_at "계좌 인증 시각"
    }

    MERCHANTS {
        int merchant_id PK "가맹점 고유 번호"
        string biz_number "사업자 번호(Unique)"
        string merchant_name "가맹점명"
        string category_code "업종 코드"
        string address "가맹점 주소"
        timestamp created_at "등록 일시"
    }

    GIFT_VOUCHER {
        int voucher_id PK "상품권 고유 번호"
        int user_id FK "소유자 ID"
        string voucher_name "상품권 명칭"
        decimal total_amount "사용 가능 잔액"
        date expiry_date "유효 기간"
    }

    TRANSACTIONS {
        int transaction_id PK "거래 고유 번호"
        int user_id FK "사용자 ID"
        int merchant_id FK "가맹점 ID"
        enum payment_type "결제 수단(ACCOUNT, GIFT_CERT)"
        int payment_source_id "결제 상세 참조 ID"
        decimal amount "결제 금액"
        enum status "거래 상태(COMPLETED, CANCELLED, FAILED)"
        timestamp transaction_date "거래 일시"
    }
        </pre>
    </div>

</body>

</html>